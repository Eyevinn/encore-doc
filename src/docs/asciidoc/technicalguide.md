## The Concept/Technical Guide

If you are looking for concepts, structures and API descriptions, this part of the documentation is for you.

### Concepts

### Workflow

_The workflow for an Encore Job_

![align="center"](img/svt_encore_workflow.png)

1. An Encore Job is created
2. It is offered to a Queuefootnote:[In reality the Encore Job itself is not offered to, or polled from the queue - it is an Object QueueItem, which holds the needed metadata for the Encore Job]. At some point, the Encore Job is picked up from the Queue
3. Metadata needed for the coming transcoding task is gathered - for example, the input file is analyzed, the Profile is read.
4. The transcoding is started - (FFmpeg transcoding starts)
5. Output files are written to the configured destination

<details>
<summary>The Encore Job status field will roughly tell the observer where in the workflow it is currently (click to expand)</summary>

```kotlin
```
</details>

#### Encore Job

_An **Encore** Job is the aggregate for the information needed to transcode an input file - information like input files, **profile** and priority._

* An **Encore** Job describes how an input file should be processed.
* An **Encore** Job can have several output files, and one input file.
* An **Encore** Job has a **_profile_**, which essentially describes how the job should configure itâ€™s transcoding.
* An **Encore** Job has a priority, which essentially describes how the job should be prioritized.

#### Profile

_A **Profile** can be seen as a general abstraction of an FFmpeg configuration - example, bitrate to use, thumbnail generation, the codec to use._

* A **Profile** specifies a big part of the configuration used by an **Encore** Job - metadata, FFmpeg configuration and specific codec configuration.
* A **Profile** is specified in the yaml-format.

#### Scaling, distribution and queues

_By using Redis (as a message broker/queue handler) and an internal concurrency scheduler, **Encore** can be scaled by setting up more instances, and allowing more concurrency._

* An **Encore** instance uses Redis through Redissonâ€™s  [_Priority Blocking Queue_](https://javadoc.io/doc/org.redisson/redisson/3.7.5/org/redisson/RedissonPriorityBlockingQueue.html). Jobs are scheduled on an **Encore** instance according to a given priority.
* Furthermore, The **Encore** concurrency setting affects how many transcoding jobs be run on the same instance at once.

_So, From an **Encore** instanceâ€™s point of view, the next Encore Job is chosen for transcoding according to its priority and according to how many concurrent tasks that are allowed on that instance._

![align="center"](img/svt_encore_queue.png)

### API/Endpoints

**Encore** is built using the framework Spring Rest Data  [offering the default endpoints](https://docs.spring.io/spring-data/rest/docs/current/reference/html/#repository-resources.fundamentals) generated from the usage of this framework.
However, other custom Endpoints exist.

**Encoreâ€™s** endpoints are described and self-documented in the [OpenAPIv3 format](https://www.openapis.org/).

#### Dynamically generated Endpoint documentation

To see and interact with the endpoints live, consult your

https://YOUR_RUNNING_ENCORE_INSTANCE/swagger-ui.html

for example, if you ran it on your localhost:

http://localhost:8080/swagger-ui.html

**ðŸ’¡ TIP**\
This is the recommended way - dynamic, powerful and
always up-to-date.

**Encore OpenAPI**

![align="center"](img/svt_encore_api.png)

#### Statically generated Endpoint documentation

To see a static version, refer to the [Static Endpoints](openapi.adoc) documentation.

**ðŸ”¥ CAUTION**\
The statically generated documentation needs to be cleaned up, as it is autogenerated, with quite a few quirks.
This will happen when the project is mature.

### Models

#### Encore Job

The Encore Job is a central object in Encore.
The Encore Job fields are described in the [Dynamically generated Endpoint documentation](#dynamically-generated-endpoint-documentation), but also in the

[EncoreJob static documentation](openapi.adoc#_encorejob)

<details>
<summary>The Encore Job class in Kotlin (click to expand)</summary>

```kotlin
```
</details>

![align="center"](img/svt_encore_job_processing.png)

#### Profile

**ðŸ“Œ NOTE**\
See the [profiles](#profiles) section in the Appendix for concrete [profile](#profile) examples.

A **Profile** consists of toplevel metadata, and a list of encoding configuration types - _encodes_.

**Profile metadata**

| Field | Description | Constraint | Default |
| --- | --- | --- | --- |
| name | profile name |  |  |
| description | a helpful description of the profile |  |  |
| scaling | directly matching the FFmpeg scaling algorithm options | if given, one of the [FFmpeg Scaling algorithm options](https://ffmpeg.org/ffmpeg-scaler.html) | lanczos |
| encodes | a list of encode types (configurations) for the profile | [AudioEncode](#audioencode) [X264Encode](#videoencode) [X265Encode](#videoencode) [ThumbnailEncode](#thumbnailencode) [ThumbnailMapEncode](#thumbnailmapencode) |  |

#### Profile Encode Types
